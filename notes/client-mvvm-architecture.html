<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MVVM æ¶æ„æ¨¡å¼ï¼šåŸç†ä¸å®è·µ | å­¦ä¹ ç¬”è®°</title>
    <meta name="description" content="æ¢è®¨ MVVM æ¶æ„çš„æ ¸å¿ƒæ€æƒ³ï¼Œç»“åˆ Qt/QML å’Œ SwiftUI å®ä¾‹åˆ†æã€‚" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="note-style.css" />
</head>

<body>
    <div class="backdrop" aria-hidden="true">
        <span class="orb orb--one"></span>
        <span class="orb orb--two"></span>
        <span class="orb orb--three"></span>
        <span class="grid"></span>
    </div>

    <header class="site-header">
        <a href="../index.html" class="brand">HU AODONG</a>
        <nav class="nav">
            <a href="../index.html#projects">ç²¾é€‰é¡¹ç›®</a>
            <a href="index.html" class="active">å­¦ä¹ ç¬”è®°</a>
            <a href="../resume.html">åœ¨çº¿ç®€å†</a>
        </nav>
    </header>

    <main class="note-container">
        <article class="note-article">
            <header class="note-header">
                <a href="index.html" class="note-back">â† è¿”å›ç¬”è®°åˆ—è¡¨</a>
                <span class="note-category client">å®¢æˆ·ç«¯</span>
                <h1>MVVM æ¶æ„æ¨¡å¼ï¼šåŸç†ä¸å®è·µ</h1>
                <div class="note-meta">
                    <span>ğŸ“… 2026-01-18</span>
                    <span>â±ï¸ çº¦ 12 åˆ†é’Ÿ</span>
                    <span>ğŸ·ï¸ MVVM, æ¶æ„è®¾è®¡, Qt, SwiftUI</span>
                </div>
            </header>

            <div class="note-content">
                <h2>1. ä»€ä¹ˆæ˜¯ MVVMï¼Ÿ</h2>
                <p><strong>MVVM (Model-View-ViewModel)</strong> æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œå°†ç”¨æˆ·ç•Œé¢å¼€å‘ä¸­çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿ä»£ç æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ã€‚</p>

                <div class="info-box">
                    <h4>ğŸ—ï¸ ä¸‰å±‚æ¶æ„</h4>
                    <ul>
                        <li><strong>Model</strong>ï¼šæ•°æ®å±‚ï¼Œè´Ÿè´£æ•°æ®è·å–ã€å­˜å‚¨å’Œä¸šåŠ¡é€»è¾‘</li>
                        <li><strong>View</strong>ï¼šè§†å›¾å±‚ï¼Œè´Ÿè´£ UI å±•ç¤ºï¼Œå°½é‡ä¿æŒè½»é‡</li>
                        <li><strong>ViewModel</strong>ï¼šè§†å›¾æ¨¡å‹ï¼Œè¿æ¥ View å’Œ Modelï¼Œå¤„ç† UI é€»è¾‘å’ŒçŠ¶æ€</li>
                    </ul>
                </div>

                <h2>2. MVVM vs MVC vs MVP</h2>

                <table class="note-table">
                    <thead>
                        <tr>
                            <th>æ¨¡å¼</th>
                            <th>æ•°æ®ç»‘å®š</th>
                            <th>æµ‹è¯•éš¾åº¦</th>
                            <th>é€‚ç”¨åœºæ™¯</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>MVC</td>
                            <td>æ— </td>
                            <td>ä¸­ç­‰</td>
                            <td>Web åç«¯ã€ç®€å• UI</td>
                        </tr>
                        <tr>
                            <td>MVP</td>
                            <td>æ‰‹åŠ¨</td>
                            <td>è¾ƒæ˜“</td>
                            <td>Android ä¼ ç»Ÿå¼€å‘</td>
                        </tr>
                        <tr>
                            <td>MVVM</td>
                            <td>è‡ªåŠ¨åŒå‘</td>
                            <td>å®¹æ˜“</td>
                            <td>ç°ä»£å£°æ˜å¼ UI</td>
                        </tr>
                    </tbody>
                </table>

                <h2>3. Qt/QML ä¸­çš„ MVVM</h2>

                <h3>3.1 ViewModel å®ç°</h3>

                <pre><code class="language-cpp">// TaskViewModel.h
class TaskViewModel : public QObject {
    Q_OBJECT
    Q_PROPERTY(QString taskName READ taskName WRITE setTaskName NOTIFY taskNameChanged)
    Q_PROPERTY(bool isLoading READ isLoading NOTIFY isLoadingChanged)
    Q_PROPERTY(QList&lt;Task*&gt; tasks READ tasks NOTIFY tasksChanged)

public:
    explicit TaskViewModel(TaskRepository* repo, QObject* parent = nullptr);

    Q_INVOKABLE void loadTasks();
    Q_INVOKABLE void addTask(const QString& name);
    Q_INVOKABLE void deleteTask(int id);

signals:
    void taskNameChanged();
    void isLoadingChanged();
    void tasksChanged();
    void errorOccurred(const QString& message);

private:
    TaskRepository* m_repository;
    QList&lt;Task*&gt; m_tasks;
    bool m_isLoading = false;
};</code></pre>

                <h3>3.2 QML View ç»‘å®š</h3>

                <pre><code class="language-qml">// TaskListView.qml
import QtQuick 2.15
import QtQuick.Controls 2.15

ListView {
    id: taskList
    model: viewModel.tasks  // è‡ªåŠ¨ç»‘å®š
    
    delegate: TaskItem {
        taskName: modelData.name
        onDeleteClicked: viewModel.deleteTask(modelData.id)
    }
    
    BusyIndicator {
        visible: viewModel.isLoading
        anchors.centerIn: parent
    }
}</code></pre>

                <h2>4. SwiftUI ä¸­çš„ MVVM</h2>

                <h3>4.1 ObservableObject ViewModel</h3>

                <pre><code class="language-swift">// TaskViewModel.swift
@MainActor
class TaskViewModel: ObservableObject {
    @Published var tasks: [Task] = []
    @Published var isLoading = false
    @Published var errorMessage: String?
    
    private let repository: TaskRepository
    
    init(repository: TaskRepository) {
        self.repository = repository
    }
    
    func loadTasks() async {
        isLoading = true
        defer { isLoading = false }
        
        do {
            tasks = try await repository.fetchTasks()
        } catch {
            errorMessage = error.localizedDescription
        }
    }
    
    func deleteTask(_ task: Task) async {
        try? await repository.delete(task)
        tasks.removeAll { $0.id == task.id }
    }
}</code></pre>

                <h3>4.2 SwiftUI View</h3>

                <pre><code class="language-swift">// TaskListView.swift
struct TaskListView: View {
    @StateObject private var viewModel = TaskViewModel(repository: .shared)
    
    var body: some View {
        List {
            ForEach(viewModel.tasks) { task in
                TaskRow(task: task)
            }
            .onDelete { indexSet in
                Task {
                    for index in indexSet {
                        await viewModel.deleteTask(viewModel.tasks[index])
                    }
                }
            }
        }
        .overlay {
            if viewModel.isLoading {
                ProgressView()
            }
        }
        .task {
            await viewModel.loadTasks()
        }
    }
}</code></pre>

                <h2>5. MVVM æœ€ä½³å®è·µ</h2>

                <div class="tip-box">
                    <h4>ğŸ’¡ è®¾è®¡å»ºè®®</h4>
                    <ol>
                        <li><strong>ViewModel ä¸åº”æŒæœ‰ View å¼•ç”¨</strong>ï¼šä¿æŒå•å‘ä¾èµ–</li>
                        <li><strong>ä½¿ç”¨ä¾èµ–æ³¨å…¥</strong>ï¼šä¾¿äºæµ‹è¯•å’Œè§£è€¦</li>
                        <li><strong>çŠ¶æ€å½’ä¸€åŒ–</strong>ï¼šé¿å…é‡å¤çŠ¶æ€ï¼Œå‡å°‘ä¸ä¸€è‡´</li>
                        <li><strong>é”™è¯¯å¤„ç†ç»Ÿä¸€</strong>ï¼šåœ¨ ViewModel ä¸­ç»Ÿä¸€å¤„ç†é”™è¯¯</li>
                        <li><strong>å¼‚æ­¥æ“ä½œç®¡ç†</strong>ï¼šä½¿ç”¨ Loading/Success/Error çŠ¶æ€æšä¸¾</li>
                    </ol>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ å¸¸è§é™·é˜±</h4>
                    <ul>
                        <li>ViewModel è¿‡äºè‡ƒè‚¿ â†’ æ‹†åˆ†ä¸ºå¤šä¸ªå° ViewModel</li>
                        <li>åœ¨ View ä¸­å†™ä¸šåŠ¡é€»è¾‘ â†’ ç§»åŠ¨åˆ° ViewModel</li>
                        <li>ç›´æ¥æ“ä½œ Model â†’ é€šè¿‡ ViewModel é—´æ¥æ“ä½œ</li>
                    </ul>
                </div>

                <h2>6. çŠ¶æ€ç®¡ç†æ¨¡å¼</h2>

                <pre><code class="language-swift">// ä½¿ç”¨æšä¸¾ç»Ÿä¸€ç®¡ç†çŠ¶æ€
enum ViewState&lt;T&gt; {
    case idle
    case loading
    case success(T)
    case error(Error)
    
    var isLoading: Bool {
        if case .loading = self { return true }
        return false
    }
}</code></pre>
            </div>

            <footer class="note-footer">
                <div class="note-nav">
                    <a href="cpp-memory-management.html" class="prev">â† C++ å†…å­˜ç®¡ç†</a>
                    <a href="network-tcp-handshake.html" class="next">TCP ä¸‰æ¬¡æ¡æ‰‹ â†’</a>
                </div>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
        <p>Â© Hu Aodong Â· Crafted for GitHub Pages</p>
    </footer>
</body>

</html>