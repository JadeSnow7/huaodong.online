<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>C++ å†…å­˜ç®¡ç†ï¼šä»å †æ ˆåˆ°æ™ºèƒ½æŒ‡é’ˆ | å­¦ä¹ ç¬”è®°</title>
    <meta name="description" content="æ·±å…¥ç†è§£ C++ å†…å­˜æ¨¡å‹ï¼ŒæŒæ¡ RAII åŸåˆ™ä¸æ™ºèƒ½æŒ‡é’ˆçš„æ­£ç¡®ä½¿ç”¨ã€‚" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="note-style.css" />
</head>

<body>
    <div class="backdrop" aria-hidden="true">
        <span class="orb orb--one"></span>
        <span class="orb orb--two"></span>
        <span class="orb orb--three"></span>
        <span class="grid"></span>
    </div>

    <header class="site-header">
        <a href="../index.html" class="brand">HU AODONG</a>
        <nav class="nav">
            <a href="../index.html#projects">ç²¾é€‰é¡¹ç›®</a>
            <a href="index.html" class="active">å­¦ä¹ ç¬”è®°</a>
            <a href="../resume.html">åœ¨çº¿ç®€å†</a>
        </nav>
    </header>

    <main class="note-container">
        <article class="note-article">
            <header class="note-header">
                <a href="index.html" class="note-back">â† è¿”å›ç¬”è®°åˆ—è¡¨</a>
                <span class="note-category cpp">C++</span>
                <h1>C++ å†…å­˜ç®¡ç†ï¼šä»å †æ ˆåˆ°æ™ºèƒ½æŒ‡é’ˆ</h1>
                <div class="note-meta">
                    <span>ğŸ“… 2026-01-20</span>
                    <span>â±ï¸ çº¦ 10 åˆ†é’Ÿ</span>
                    <span>ğŸ·ï¸ æ™ºèƒ½æŒ‡é’ˆ, RAII, å†…å­˜æ¨¡å‹</span>
                </div>
            </header>

            <div class="note-content">
                <h2>1. å†…å­˜åŒºåŸŸæ¦‚è¿°</h2>
                <p>C++ ç¨‹åºçš„å†…å­˜é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŒºåŸŸï¼š</p>

                <div class="info-box">
                    <h4>ğŸ“¦ å†…å­˜åˆ†åŒº</h4>
                    <ul>
                        <li><strong>æ ˆåŒº (Stack)</strong>ï¼šå­˜æ”¾å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ï¼Œè‡ªåŠ¨ç®¡ç†</li>
                        <li><strong>å †åŒº (Heap)</strong>ï¼šåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†æˆ–ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</li>
                        <li><strong>å…¨å±€/é™æ€åŒº</strong>ï¼šå­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡</li>
                        <li><strong>å¸¸é‡åŒº</strong>ï¼šå­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ç­‰</li>
                        <li><strong>ä»£ç åŒº</strong>ï¼šå­˜æ”¾ç¨‹åºçš„äºŒè¿›åˆ¶ä»£ç </li>
                    </ul>
                </div>

                <h2>2. æ ˆä¸å †çš„åŒºåˆ«</h2>

                <table class="note-table">
                    <thead>
                        <tr>
                            <th>ç‰¹æ€§</th>
                            <th>æ ˆ (Stack)</th>
                            <th>å † (Heap)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç®¡ç†æ–¹å¼</td>
                            <td>ç¼–è¯‘å™¨è‡ªåŠ¨ç®¡ç†</td>
                            <td>ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>åˆ†é…é€Ÿåº¦</td>
                            <td>å¿«ï¼ˆç§»åŠ¨æ ˆæŒ‡é’ˆï¼‰</td>
                            <td>æ…¢ï¼ˆéœ€è¦æŸ¥æ‰¾ç©ºé—²å—ï¼‰</td>
                        </tr>
                        <tr>
                            <td>ç©ºé—´å¤§å°</td>
                            <td>è¾ƒå°ï¼ˆé€šå¸¸ 1-8 MBï¼‰</td>
                            <td>è¾ƒå¤§ï¼ˆå—ç³»ç»Ÿé™åˆ¶ï¼‰</td>
                        </tr>
                        <tr>
                            <td>ç¢ç‰‡é—®é¢˜</td>
                            <td>æ— </td>
                            <td>å¯èƒ½äº§ç”Ÿç¢ç‰‡</td>
                        </tr>
                    </tbody>
                </table>

                <h2>3. RAII åŸåˆ™</h2>
                <p><strong>RAII (Resource Acquisition Is Initialization)</strong> æ˜¯ C++ ä¸­ç®¡ç†èµ„æºçš„æ ¸å¿ƒåŸåˆ™ï¼š</p>

                <pre><code class="language-cpp">class FileHandler {
public:
    FileHandler(const std::string& path) {
        file_ = fopen(path.c_str(), "r");
        if (!file_) throw std::runtime_error("Failed to open file");
    }
    
    ~FileHandler() {
        if (file_) fclose(file_);  // ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾
    }
    
    // ç¦ç”¨æ‹·è´
    FileHandler(const FileHandler&) = delete;
    FileHandler& operator=(const FileHandler&) = delete;
    
private:
    FILE* file_;
};</code></pre>

                <h2>4. æ™ºèƒ½æŒ‡é’ˆè¯¦è§£</h2>

                <h3>4.1 std::unique_ptr</h3>
                <p>ç‹¬å æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆï¼Œä¸å¯å¤åˆ¶ä½†å¯ç§»åŠ¨ï¼š</p>

                <pre><code class="language-cpp">// åˆ›å»º unique_ptr
auto ptr = std::make_unique&lt;MyClass&gt;(args...);

// è½¬ç§»æ‰€æœ‰æƒ
auto ptr2 = std::move(ptr);  // ptr å˜ä¸º nullptr

// è‡ªå®šä¹‰åˆ é™¤å™¨
auto filePtr = std::unique_ptr&lt;FILE, decltype(&fclose)&gt;(
    fopen("data.txt", "r"), &fclose
);</code></pre>

                <h3>4.2 std::shared_ptr</h3>
                <p>å…±äº«æ‰€æœ‰æƒï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼š</p>

                <pre><code class="language-cpp">auto sp1 = std::make_shared&lt;MyClass&gt;();
auto sp2 = sp1;  // å¼•ç”¨è®¡æ•° +1

std::cout &lt;&lt; sp1.use_count();  // è¾“å‡º: 2</code></pre>

                <div class="warning-box">
                    <h4>âš ï¸ æ³¨æ„ï¼šå¾ªç¯å¼•ç”¨é—®é¢˜</h4>
                    <p>å½“ä¸¤ä¸ªå¯¹è±¡é€šè¿‡ <code>shared_ptr</code> äº’ç›¸å¼•ç”¨æ—¶ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ä½¿ç”¨ <code>weak_ptr</code> æ‰“ç ´å¾ªç¯ã€‚</p>
                </div>

                <h3>4.3 std::weak_ptr</h3>
                <p>å¼±å¼•ç”¨ï¼Œä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼š</p>

                <pre><code class="language-cpp">std::weak_ptr&lt;MyClass&gt; wp = sp1;

if (auto locked = wp.lock()) {
    // ä½¿ç”¨ lockedï¼ˆshared_ptrï¼‰
} else {
    // å¯¹è±¡å·²è¢«é”€æ¯
}</code></pre>

                <h2>5. æœ€ä½³å®è·µ</h2>

                <div class="tip-box">
                    <h4>ğŸ’¡ å†…å­˜ç®¡ç†å»ºè®®</h4>
                    <ol>
                        <li>ä¼˜å…ˆä½¿ç”¨æ ˆåˆ†é…ï¼Œå…¶æ¬¡ä½¿ç”¨ <code>make_unique</code></li>
                        <li>éœ€è¦å…±äº«æ‰€æœ‰æƒæ—¶ä½¿ç”¨ <code>make_shared</code></li>
                        <li>é¿å…è£¸æŒ‡é’ˆ <code>new/delete</code></li>
                        <li>ç”¨ <code>weak_ptr</code> æ‰“ç ´å¾ªç¯å¼•ç”¨</li>
                        <li>è€ƒè™‘ä½¿ç”¨ <code>std::span</code> ä¼ é€’æ•°ç»„è§†å›¾</li>
                    </ol>
                </div>

                <h2>6. å¸¸è§é¢è¯•é¢˜</h2>

                <div class="qa-box">
                    <p class="question">Q: shared_ptr çš„å¼•ç”¨è®¡æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</p>
                    <p class="answer">A: å¼•ç”¨è®¡æ•°çš„å¢å‡æ˜¯åŸå­æ“ä½œï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æŒ‡å‘å¯¹è±¡çš„è®¿é—®ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦é¢å¤–åŒæ­¥ã€‚</p>
                </div>

                <div class="qa-box">
                    <p class="question">Q: ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ make_shared è€Œä¸æ˜¯ newï¼Ÿ</p>
                    <p class="answer">A: make_shared åªéœ€ä¸€æ¬¡å†…å­˜åˆ†é…ï¼ˆå¯¹è±¡å’Œæ§åˆ¶å—ä¸€èµ·ï¼‰ï¼Œè€Œ new + shared_ptr éœ€è¦ä¸¤æ¬¡ã€‚æ­¤å¤–ï¼Œmake_shared æ˜¯å¼‚å¸¸å®‰å…¨çš„ã€‚
                    </p>
                </div>
            </div>

            <footer class="note-footer">
                <div class="note-nav">
                    <span></span>
                    <a href="client-mvvm-architecture.html" class="next">MVVM æ¶æ„æ¨¡å¼ â†’</a>
                </div>
            </footer>
        </article>
    </main>

    <footer class="site-footer">
        <p>Â© Hu Aodong Â· Crafted for GitHub Pages</p>
    </footer>
</body>

</html>